# Listen on HTTP only - Cloudflare Tunnel handles HTTPS
:80 {
    # Only allow GET requests to /api/interactions/{post_id}
    @allowed {
        method GET
        path /api/interactions/*
    }

    # Add security headers
    header {
        # Prevent clickjacking
        X-Frame-Options "DENY"
        # Prevent content-type sniffing
        X-Content-Type-Options "nosniff"
        # Enable XSS protection
        X-XSS-Protection "1; mode=block"
        # Remove server header
        -Server
    }

    handle @allowed {
        reverse_proxy ghost-posse:5000
    }

    # Deny all other requests
    handle {
        respond "Not found" 404
    }
}
